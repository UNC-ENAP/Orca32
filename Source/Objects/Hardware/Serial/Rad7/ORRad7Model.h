//--------------------------------------------------------
// ORRad7Model
// Created by Mark  A. Howe on Fri Jul 22 2005
// Code partially generated by the OrcaCodeWizard. Written by Mark A. Howe.
// Copyright (c) 2005 CENPA, University of Washington. All rights reserved.
//-----------------------------------------------------------
//This program was prepared for the Regents of the University of 
//Washington at the Center for Experimental Nuclear Physics and 
//Astrophysics (CENPA) sponsored in part by the United States 
//Department of Energy (DOE) under Grant #DE-FG02-97ER41020. 
//The University has certain rights in the program pursuant to 
//the contract and the program should not be copied or distributed 
//outside your organization.  The DOE and the University of 
//Washington reserve all rights in the program. Neither the authors,
//University of Washington, or U.S. Government make any warranty, 
//express or implied, or assume any liability or responsibility 
//for the use of this software.
//-------------------------------------------------------------

#pragma mark ***Imported Files

@class ORSerialPort;
@class ORTimeRate;

#define  kRad7Unknown		0

#define kRad7PumpModeAuto	1
#define kRad7PumpModeOn		2
#define kRad7PumpModeOff	3
#define kRad7PumpModeGrab	4

#define kRad7ThoronOn		1
#define kRad7ThoronOff		2

#define kRad7ModeSniff		1
#define kRad7ModeAuto		2
#define kRad7ModeWat40		3
#define kRad7ModeWat250		4
#define kRad7ModeNormal		5

#define  kRad7ModeOFF		1
#define  kRad7ToneChime		2
#define  kRad7ToneGeiger	3

#define  kRad7FormatOff		1
#define  kRad7FormatShort	2
#define  kRad7FormatMedium	3
#define  kRad7FormatLong	4

#define  kRad7PciL			1
#define  kRad7bqm3			2
#define  kRad7cpm			3
#define  kRad7ncnts			4

#define  kRad7Centigrade	1
#define  kRad7Fahrenheit	2

#define kRad7ProtocolNone	1
#define kRad7ProtocolSniff	2
#define kRad7Protocol1Day	3
#define kRad7Protocol2Day	4
#define kRad7ProtocolWeeks	5
#define kRad7ProtocolUser	6
#define kRad7ProtocolGrab	7
#define kRad7ProtocolWat40	8
#define kRad7ProtocolWat250	9
#define kRad7ProtocolThoron	10

#define kRad7Idle			  0
#define kRad7UpdatingSettings 1


@interface ORRad7Model : OrcaObject
{
    @private
        NSString*       portName;
        BOOL            portWasOpen;
        ORSerialPort*   serialPort;
        unsigned long	dataId;
		NSString*		lastRequest;
		NSMutableArray* cmdQueue;
		unsigned long	timeMeasured;
		int				pollTime;
        NSMutableString* buffer;
		BOOL			shipTemperature;
		ORTimeRate*		timeRate;
		unsigned int    currentRequest;
		unsigned int    requestState;
		unsigned int    expectedCount;
		unsigned int    requestCount;
		int				protocol;
		int				cycleTime;
		int				recycle;
		int				mode;
		BOOL			thoron;
		int				pumpMode;
		int				tone;
		int				formatSetting;
		int				rUnits;
		int				tUnits;
		int				operationState;
}

#pragma mark ***Initialization
- (id)   init;
- (void) dealloc;
- (void) registerNotificationObservers;
- (void) dataReceived:(NSNotification*)note;

#pragma mark ***Accessors
- (int) operationState;
- (void) setOperationState:(int)aOperationState;
- (NSString*) operationStateString;
- (int) tUnits;
- (void) setTUnits:(int)aUnits;
- (int) rUnits;
- (void) setRUnits:(int)aUnits;
- (int) formatSetting;
- (void) setFormatSetting:(int)aFormat;
- (int) tone;
- (void) setTone:(int)aTone;
- (int) pumpMode;
- (void) setPumpMode:(int)aPumpMode;
- (BOOL) thoron;
- (void) setThoron:(BOOL)aThoron;
- (int) mode;
- (void) setMode:(int)aMode;
- (int) recycle;
- (void) setRecycle:(int)aRecycle;
- (int) cycleTime;
- (void) setCycleTime:(int)aCycleTime;
- (int) protocol;
- (void) setProtocol:(int)aProtocol;
- (ORTimeRate*)timeRate;
- (BOOL) shipTemperature;
- (void) setShipTemperature:(BOOL)aShipTemperature;
- (int) pollTime;
- (void) setPollTime:(int)aPollTime;
- (ORSerialPort*) serialPort;
- (void) setSerialPort:(ORSerialPort*)aSerialPort;
- (BOOL) portWasOpen;
- (void) setPortWasOpen:(BOOL)aPortWasOpen;
- (NSString*) portName;
- (void) setPortName:(NSString*)aPortName;
- (NSString*) lastRequest;
- (void) setLastRequest:(NSString*)aRequest;
- (void) openPort:(BOOL)state;
- (unsigned long) timeMeasured;

- (int) convertPumpModeStringToIndex:(NSString*)aPumpMode;
- (int) convertThoronStringToIndex:(NSString*)aMode;
- (int) convertCycleHours:(NSString*)hourString minutes:(NSString*)minutesString;
- (int) convertModeStringToIndex:(NSString*)aMode;
- (int) convertToneStringToIndex:(NSString*)aMode;
- (int) convertFormatStringToIndex:(NSString*)aMode;
- (void) convertUnitsString:(NSString*)aUnitsString;
- (int) convertProtocolStringToIndex:(NSString*)aProtocol;

#pragma mark ***Data Records
- (void) appendDataDescription:(ORDataPacket*)aDataPacket userInfo:(id)userInfo;
- (NSDictionary*) dataRecordDescription;
- (unsigned long) dataId;
- (void) setDataId: (unsigned long) DataId;
- (void) setDataIds:(id)assigner;
- (void) syncDataIdsWith:(id)anotherRad7;
- (void) shipTemps;

#pragma mark ***Commands
- (void) addCmdToQueue:(NSString*)aCmd;
- (void) readData;
- (void) updateSettings;
- (id)   initWithCoder:(NSCoder*)decoder;
- (void) encodeWithCoder:(NSCoder*)encoder;

@end

extern NSString* ORRad7ModelOperationStateChanged;
extern NSString* ORRad7ModelTUnitsChanged;
extern NSString* ORRad7ModelRUnitsChanged;
extern NSString* ORRad7ModelFormatChanged;
extern NSString* ORRad7ModelToneChanged;
extern NSString* ORRad7ModelPumpModeChanged;
extern NSString* ORRad7ModelThoronChanged;
extern NSString* ORRad7ModelModeChanged;
extern NSString* ORRad7ModelRecycleChanged;
extern NSString* ORRad7ModelCycleTimeChanged;
extern NSString* ORRad7ModelProtocolChanged;
extern NSString* ORRad7ModelShipTemperatureChanged;
extern NSString* ORRad7ModelPollTimeChanged;
extern NSString* ORRad7ModelSerialPortChanged;
extern NSString* ORRad7Lock;
extern NSString* ORRad7ModelPortNameChanged;
extern NSString* ORRad7ModelPortStateChanged;
